"use strict";require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.symbol.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.array.from.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.function.name.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.processMergeIdentifiers=exports.processMergeIdentifier=exports.zipper=exports.findMergeReferenceKeys=exports.mergeReferenceArrays=exports.createMergeReferenceIdentifier=void 0,require("core-js/modules/es.array.map.js"),require("core-js/modules/es.array.find-index.js"),require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.array.splice.js"),require("core-js/modules/es.array.filter.js");var _arrays=require("../arrays"),_functions=require("../functions"),_objects=require("../objects"),_cloneHelpers=require("./cloneHelpers");function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}var createMergeReferenceIdentifier=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t=e.map((function(e){return(0,_cloneHelpers.createReferenceIdentifier)(e,r,n)})),i=(0,_cloneHelpers.createReferenceIdentifier)(e[0],r,n);return i.object=Array.isArray(i.original)?[]:{},i.identifiers=t,i};exports.createMergeReferenceIdentifier=createMergeReferenceIdentifier;var mergeReferenceArrays=function e(r,n){if(!Array.isArray(n))return r.findIndex((function(e){return Array.isArray(e)?e[0]===n:e===n}))<0&&r.push(n),r;var t=r.findIndex((function(e){return Array.isArray(e)?e[0]===n[0]:e===n[0]}));if(Array.isArray(n[1])&&(n[1]=n[1].reduce(e,[])),t<0)return[].concat(_toConsumableArray(r),[n]);if(!Array.isArray(r[t]))return(0,_objects.setValue)(t,n,r);if(1===r[t].length)return(0,_objects.setValue)(t,n,r);var i=r[t][1];return Array.isArray(i)?(Array.isArray(n[1])&&(i=(0,_arrays.mergeArrays)(i,n[1])),!Array.isArray(n[1])&&Array.isArray(i)&&i.push(n[1]),(0,_objects.setValue)(t,[n[0],i.reduce(e,[])],r)):(0,_objects.setValue)(t,[n[0],i],r)};exports.mergeReferenceArrays=mergeReferenceArrays;var findMergeReferenceKeys=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e[r].references.reduce((function(t,i,s){var o=t.identifiers.reduce((function(e,r){var n=r.original[i];return void 0===n||(0,_cloneHelpers.nonReference)(n)?e:[].concat(_toConsumableArray(e),[n])}),[]),a=e.findIndex((function(e){return e&&e.identifiers.some((function(e){return o.includes(e.original)}))}));if(a>=0)return t.object[i]=a,t.circular.push(i),e[a].referers.push(r),t;if(n)return t.object[i]=Array.isArray(o[0])?[]:{},t;var c=e[e.length-1].index+1;return t.object[i]=c,e[c]=createMergeReferenceIdentifier(o,c,[r]),t}),e[r])};exports.findMergeReferenceKeys=findMergeReferenceKeys;var zipper=function(e){e.identifiers=e.identifiers.map((function(e){return(0,_cloneHelpers.findObjectReferences)(e)}));var r=_arrays.mergeArrays.apply(void 0,_toConsumableArray(e.identifiers.map((function(e){return e.references}))));r=r.reduce(mergeReferenceArrays,[]);var n=Array.isArray(e.object);return(n?_arrays.compareArrays.apply(void 0,_toConsumableArray(e.identifiers.map((function(e){return e.object})))):_arrays.compareArrays.apply(void 0,_toConsumableArray(e.identifiers.map((function(e){return(0,_objects.objectKeys)(e.object)}))))).reduce((function(t,i){for(var s=i.value,o=null,a=null,c=i.result.length-1;c>=0;--c)if(!(i.result[c]<0)){if(n&&(s=i.keys[c][0]),o=e.identifiers[c].object[s],null!==a||!(0,_objects.emptyObject)(o))break;a=o}if(null!==a&&null!==o&&(o=a),null!==o){var u=r.findIndex((function(e){return Array.isArray(e)?Array.isArray(e[0])?e[0][0]===s:e[0]===s:e===s}));u>=0&&r.splice(u,1)}return t.references=r,n?(t.object.push(o),t):(t.object[s]=o,t)}),e)};exports.zipper=zipper;var processMergeIdentifier=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=n.mapLimit,i=void 0===t?100:t,s=n.depthLimit,o=void 0===s?-1:s,a=0,c=!1;return e=(0,_functions.pipe)((function(r){return(0,_cloneHelpers.findReferenceIndex)(e,r.index)}),(function(r){return zipper(e[a=r])}),(function(r){return(0,_cloneHelpers.getIdentifierDepth)(e,r)}),(function(e){return e===o}),(function(r){return findMergeReferenceKeys(e,a,c=r)}),(function(n){c&&(e[a].references=n.circular),e[a].complete=!0;var t=e[a].references.filter((function(e){return!n.circular.includes(e)}));return r=[].concat(_toConsumableArray(r),_toConsumableArray(t.map((function(r){return e[n.object[r]]})))),e.length>=i}),(function(r){return r?(0,_cloneHelpers.linkReferences)(e):e}))(r.shift()),r};exports.processMergeIdentifier=processMergeIdentifier;var processMergeIdentifiers=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.mapLimit,t=void 0===n?100:n,i=r.depthLimit,s=void 0===i?-1:i,o=[createMergeReferenceIdentifier(e,0)],a=[o[0]];do{a=processMergeIdentifier(o,a,{mapLimit:t,depthLimit:s})}while(a.length>0);return o};exports.processMergeIdentifiers=processMergeIdentifiers;