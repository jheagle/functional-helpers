"use strict";require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.symbol.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.array.from.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.function.name.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.processIdentifiers=exports.processIdentifier=exports.linkReferences=exports.removeFromReferenceMap=exports.linkReferenceObject=exports.objectAndReferences=exports.getIdentifierDepth=exports.findReference=exports.findReferenceIndex=exports.findReferenceKeys=exports.findObjectReferences=exports.createReferenceIdentifier=void 0,require("core-js/modules/es.object.assign.js"),require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.array.find-index.js"),require("core-js/modules/es.array.splice.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.array.filter.js");var _functions=require("../functions"),_objects=require("../objects");function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}var nonReference=function(e){return!(0,_objects.isCloneable)(e)},createReferenceIdentifier=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object.assign({},{circular:[],complete:!1,index:r,object:null,original:e,references:[],referers:n})};exports.createReferenceIdentifier=createReferenceIdentifier;var findObjectReferences=function(e){return(0,_objects.setValue)("object",(0,_objects.mapObject)(e.original,(function(r,n){return nonReference(r)?r:(e.references.push(n),null)})),e)};exports.findObjectReferences=findObjectReferences;var findReferenceKeys=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e[r].references.reduce((function(t,i,o){var c=t.original[i],s=e.findIndex((function(e){return e&&c===e.original}));if(s>=0)return t.object[i]=s,t.circular.push(i),e[s].referers.push(r),t;if(n)return t.object[i]=Array.isArray(t.original[i])?[]:{},t;var f=e[e.length-1].index+1;return t.object[i]=e[e.length-1].index+1,e[f]=createReferenceIdentifier(c,t.object[i],[r]),t}),e[r])};exports.findReferenceKeys=findReferenceKeys;var findReferenceIndex=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e[r];if(n&&n.index===r)return r;if(n&&n.index>r)for(var t=r;--t>=0;)if(e[t]&&e[t].index===r)return t;return e.findIndex((function(e){return void 0!==e&&e.index===r}))};exports.findReferenceIndex=findReferenceIndex;var findReference=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[findReferenceIndex(e,r)]};exports.findReference=findReference;var getIdentifierDepth=function e(r,n){if(!n.referers.length)return 0;var t=Math.min.apply(Math,_toConsumableArray(n.referers));if(t>=n.index)return 0;if(0===t)return 1;var i=findReference(r,t);return i?1+e(r,i):t};exports.getIdentifierDepth=getIdentifierDepth;var hasCompletedReferences=function(e){return e.some((function(e){return e.index>0&&e.complete}))},objectAndReferences=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object.assign({},{index:n,object:e,references:r,remove:[]})};exports.objectAndReferences=objectAndReferences;var linkReferenceObject=function e(r){return function(n,t,i){var o=!1,c=t;if(Array.isArray(t)&&null===(c=Array.isArray(t[0])?t[0]:t)[1]&&(t=c[0],o=!0),Array.isArray(t)){var s,f=n.object[c[0]];"number"==typeof f&&(n.index=f);var u=c[1].reduce(e(r),objectAndReferences(f,c[1],n.index));return n.object[c[0]]=u.object,s=u.remove,n.references[i][1].length||n.references.splice(i,1),n.remove=[].concat(_toConsumableArray(n.remove),_toConsumableArray(s)),n}var a=findReference(r,n.object[t]);if(!a.complete)return n;n.object[t]=a.object,a.referers.splice(a.referers.findIndex((function(e){return e===n.index})),1);var d=a.references.map((function(e){return a.circular.includes(e)?[e,null]:e}));return n.remove.push(a),d.length&&!o?(n.references[i]=[t,d],n):(n.references.splice(i,1),n)}};exports.linkReferenceObject=linkReferenceObject;var removeFromReferenceMap=function(e){return function(r){var n=findReferenceIndex(e,r.index);if(n<=0||r.referers.length)return 0===n;e.splice(n,1);var t=e[0].referers.indexOf(r.index);return t>=0&&e[0].referers.splice(t,1),!0}};exports.removeFromReferenceMap=removeFromReferenceMap;var linkReferences=function e(r){if(!r[0].complete)return r;var n=r[0].references.reduce(linkReferenceObject(r),objectAndReferences(r[0].object,r[0].references,0));return r[0].object=n.object,r[0].references=n.references,n.remove.forEach(removeFromReferenceMap(r)),hasCompletedReferences(r)?e(r):r};exports.linkReferences=linkReferences;var processIdentifier=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=n.mapLimit,i=void 0===t?100:t,o=n.depthLimit,c=void 0===o?-1:o,s=0,f=!1;return e=(0,_functions.pipe)((function(r){return findReferenceIndex(e,r.index)}),(function(r){return findObjectReferences(e[s=r])}),(function(r){return getIdentifierDepth(e,r)}),(function(e){return e===c}),(function(r){return findReferenceKeys(e,s,f=r)}),(function(n){f&&(e[s].references=n.circular),e[s].complete=!0;var t=e[s].references.filter((function(e){return!n.circular.includes(e)}));return r=[].concat(_toConsumableArray(r),_toConsumableArray(t.map((function(r){return e[n.object[r]]})))),e.length>=i}),(function(r){return r?linkReferences(e):e}))(r.shift()),r};exports.processIdentifier=processIdentifier;var processIdentifiers=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.mapLimit,t=void 0===n?100:n,i=r.depthLimit,o=void 0===i?-1:i,c=[createReferenceIdentifier(e,0)],s=[c[0]];do{s=processIdentifier(c,s,{mapLimit:t,depthLimit:o})}while(s.length>0);return c};exports.processIdentifiers=processIdentifiers;